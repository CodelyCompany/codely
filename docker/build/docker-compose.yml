version: '3'

services:
    mongodb:
        container_name: mongodb
        image: mongo:latest
        volumes:
            - /home/mtx22/mongodb/database:/data/db
        environment:
            - MONGO_INITDB_DATABASE=local
            - MONGO_INITDB_ROOT_USERNAME=user
            - MONGO_INITDB_ROOT_PASSWORD=secr3t
        networks:
            - container_network
    backend:
        restart: always
        build:
            dockerfile: Dockerfile
            context: ../../backend
        depends_on:
            - 'mongodb'
        environment:
            - MONGO_HOST=mongodb
            - MONGO_PORT=27017
            - MONGO_DATABASE=local
            - MONGO_USERNAME=user
            - MONGO_PASSWORD=secr3t
            - BACKEND_CONTAINERS=http://backend_containers:5001'
        volumes:
            - ../../backend:/opt/app
        networks:
            - container_network
    backend_containers:
        restart: always
        build:
            dockerfile: Dockerfile
            context: ../../backend_containers
        depends_on:
            - 'javascript'
            - 'python'
            - 'bash'
            - 'java'
            - 'cpp'
            - 'c'
            - 'r'
        volumes:
            - ../../backend_containers:/opt/app
        networks:
            - container_network
    javascript:
        restart: always
        build:
            dockerfile: Dockerfile
            context: ../../containers/javascript
        environment:
            - PORT=6000
        networks:
            - container_network
    python:
        restart: always
        build:
            dockerfile: Dockerfile
            context: ../../containers/python
        environment:
            - PORT=6001
        networks:
            - container_network
    bash:
        restart: always
        build:
            dockerfile: Dockerfile
            context: ../../containers/bash
        environment:
            - PORT=6002
        networks:
            - container_network
    java:
        restart: always
        build:
            dockerfile: Dockerfile
            context: ../../containers/java
        environment:
            - PORT=6003
        networks:
            - container_network
    cpp:
        restart: always
        build:
            dockerfile: Dockerfile
            context: ../../containers/cpp
        environment:
            - PORT=6004
        networks:
            - container_network
    c:
        restart: always
        build:
            dockerfile: Dockerfile
            context: ../../containers/c
        environment:
            - PORT=6005
        networks:
            - container_network
    r:
        restart: always
        build:
            dockerfile: Dockerfile
            context: ../../containers/r
        environment:
            - PORT=6006
        networks:
            - container_network
    frontend:
        restart: always
        build:
            dockerfile: Dockerfile
            context: ../../frontend
        depends_on:
            - 'backend'
            - 'backend_containers'
        volumes:
            - ../../frontend/node_modules:/opt/app/node_modules
            - ../../frontend:/opt/app
        environment:
            - REACT_APP_CONTAINERS_ADDRESS=http://backend_containers:5001
            - REACT_APP_BACKEND=http://backend:5000
            - REACT_APP_DOMAIN=dev-v6t-co5x.us.auth0.com
            - REACT_APP_CLIENT_ID=S78rEYoT9kikIwcv3l0AI1Lg49AxSmMb
        networks:
            - container_network
    auth0:
        restart: always
        image: yannj/auth0-docker:latest
        environment:
            - AUTH0_CLIENT_ID=S78rEYoT9kikIwcv3l0AI1Lg49AxSmMb
            - AUTH0_DOMAIN=dev-v6t-co5x.us.auth0.com
            - AUTH0_CLIENT_SECRET=c-aZ9-dAmNzjT7c0D7yfxwZ4vo8n2e2te9_qEF5yX-XoSHjRcY64DgWLbPF8dkq3
        networks:
            - container_network
    nginx:
        restart: always
        build:
            dockerfile: Dockerfile
            context: ../../frontend
            target: nginx
        ports:
            - '9090:80'
        networks:
            - container_network
networks:
    container_network:
        driver: bridge
